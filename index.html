<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Noughts & Crosses — 3-Piece Cycle</title>
<style>
  :root{
    --grid-line:#222;
    --bg:#0f0f12;
    --panel:#16181d;
    --text:#f3f4f6;
    --muted:#9aa3af;
    --accent:#5eead4;
    --x-color:#e11d48;
    --o-color:#2563eb;
    --cell-size:clamp(60px, 22vmin, 140px);
    --gap:clamp(6px, 1.5vmin, 12px);
    --radius:14px;
    --shadow:0 6px 20px rgba(0,0,0,.35);
  }
  html,body{height:100%;margin:0;background:#0b0c10;color:var(--text);font-family:sans-serif;}
  .app{min-height:100%;display:grid;grid-template-rows:auto 1fr auto;gap:16px;padding:clamp(12px,2.5vmin,24px);}
  header{display:flex;flex-wrap:wrap;align-items:center;gap:12px;justify-content:space-between;}
  header h1{font-size:clamp(18px,2.6vmin,28px);margin:0;}
  .board-container{display: flex;justify-content: center;align-items:center;height:calc(100vh-20px);padding:20px;box-sizing: border-box;}
  .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;background:var(--panel);padding:10px 12px;border-radius:12px;}
  .controls label{font-size:14px;color:var(--muted);}
  select,button{appearance:none;background:#121722;color:var(--text);border:1px solid #2a2f3d;border-radius:10px;padding:8px 10px;font-size:14px;outline:none;}
  button.primary{background:linear-gradient(180deg,#10b981,#0ea5e9);border:none;font-weight:600;}
  .status{font-weight:600;padding:6px 10px;border-radius:10px;background:#0f131a;}
  .score{margin-left:10px;font-weight:600;}
  #score-controls{display:flex;align-items:center;gap:10px;}
  .icon-btn {background:linear-gradient(180deg,#10b981,#0ea5e9);border:none;padding:4px;cursor:pointer;display:flex;align-items:center;}
  .icon-btn img {width:24px;height:24px;pointer-events:none;}
  .icon-btn:hover img {filter:brightness(1.2); }
  .board{display:grid;grid-template-columns:repeat(3,var(--cell-size));grid-template-rows:repeat(3,var(--cell-size));gap:var(--gap);padding:var(--gap);background:#111827;border-radius:var(--radius);}
  .cell{display:grid;place-items:center;background:#0a0d15;border:1px solid #1c2130;border-radius:10px;cursor:pointer;transition:transform .2s ease, opacity .5s ease;font-size:clamp(28px,8vmin,60px);font-weight:900;line-height:1;outline:none;}
  .cell.X{color:var(--x-color);}
  .cell.O{color:var(--o-color);}
  .cell.remove-next{transform:scale(0.75);}
  .cell.fade-out{opacity:0;}
  .win{animation:blink .22s steps(2) 0s 8;}
  @keyframes blink{50%{filter:brightness(2);}}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Noughts & Crosses</h1>
    <div class="controls">
      <label>X colour <select id="xColor"><option value="#e11d48" selected>Rose</option><option value="#10b981">Green</option></select></label>
      <label>O colour <select id="oColor"><option value="#2563eb" selected>Blue</option><option value="#f59e0b">Amber</option></select></label>
      <button id="resetBtn" class="primary">Restart</button>
      <div id="status" class="status">Turn: X</div>
      <div id="score-controls">
      <div id="score" class="score">X: 0 – O: 0</div>
      <button id="resetScoreBtn" class="icon-btn" aria-label="Reset Score">
        <img src="https://www.freeiconspng.com/thumbs/restart-icon/black-panel-restart-system-icon--6.png" alt="Undo" />
      </button>
      </div>
  </header>
  <main class="board-container">
  <div id="board" class="board"></div>
</main>
</div>

<script>
  const boardEl = document.getElementById('board');
  const scoreEl = document.getElementById('score');
  const resetScoreBtn = document.getElementById('resetScoreBtn');
  const xColorEl = document.getElementById('xColor');
  const oColorEl = document.getElementById('oColor');

  let board = Array(9).fill(null);
  let currentPlayer = 'X';
  let moves = { X: [], O: [] };
  let score = JSON.parse(localStorage.getItem('score')) || { X: 0, O: 0 };
  let starter = 'X'; // alternates after each restart
  scoreEl.textContent = `X: ${score.X} – O: ${score.O}`;

  // Create board
  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index = i;
    cell.tabIndex = 0;
    cell.addEventListener('click', () => handleMove(i));
    cell.addEventListener('keydown', (e) => {
      if (e.key === "Enter" || e.key === " ") handleMove(i);
    });
    boardEl.appendChild(cell);
  }

  function handleMove(index) {
    if (board[index]) return; // already occupied

    const cell = boardEl.children[index];
    const color = currentPlayer === 'X' ? xColorEl.value : oColorEl.value;

    // Place piece
    board[index] = currentPlayer;
    cell.textContent = currentPlayer;
    cell.style.color = color;
    moves[currentPlayer].push(index);

    // Manage 3-piece rule
    if (moves[currentPlayer].length > 3) {
      const oldestIndex = moves[currentPlayer].shift(); // remove oldest from array
      const oldestCell = boardEl.children[oldestIndex];
      oldestCell.classList.remove('small'); // reset previous shrink
      oldestCell.classList.add('fade-out');
      setTimeout(() => {
        board[oldestIndex] = null;
        oldestCell.textContent = '';
        oldestCell.classList.remove('fade-out');
      }, 500); // fade duration
    }

    // Mark next-to-go (shrink oldest if 3 are on board)
    markNextToGo();

    // Check for win AFTER removal handled
    setTimeout(() => {
      if (checkWin(currentPlayer)) {
        score[currentPlayer]++;
        localStorage.setItem('score', JSON.stringify(score));
        scoreEl.textContent = `X: ${score.X} – O: ${score.O}`;
        restart();
      } else if (board.every(cell => cell)) {
        restart(); // draw
      } else {
        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
      }
    }, 550); // ensure after fade-out
  }

  function markNextToGo() {
    // reset all small
    [...boardEl.children].forEach(c => c.classList.remove('small'));
    // shrink the oldest of current player if they have 3 pieces
    ['X','O'].forEach(p => {
      if (moves[p].length === 3) {
        const oldestIndex = moves[p][0];
        boardEl.children[oldestIndex].classList.add('small');
      }
    });
  }

  function checkWin(player) {
    const wins = [
      [0,1,2],[3,4,5],[6,7,8],
      [0,3,6],[1,4,7],[2,5,8],
      [0,4,8],[2,4,6]
    ];
    return wins.some(comb => comb.every(i => board[i] === player));
  }

  function restart() {
    board.fill(null);
    moves = { X: [], O: [] };
    [...boardEl.children].forEach(c => {
      c.textContent = '';
      c.classList.remove('small', 'fade-out');
    });
    // Alternate starting player
    starter = starter === 'X' ? 'O' : 'X';
    currentPlayer = starter;
  }

  resetScoreBtn.addEventListener('click', () => {
    score = { X: 0, O: 0 };
    localStorage.setItem('score', JSON.stringify(score));
    scoreEl.textContent = `X: ${score.X} – O: ${score.O}`;
  });
</script>
</body>
</html>
